---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "integration/roam_sentences.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: integration/roam_sentences.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">proseflow.aws_utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">proseflow.load</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">proseflow.text</span> <span class="kn">import</span> <span class="n">text_to_vector</span><span class="p">,</span> <span class="n">create_index</span><span class="p">,</span> <span class="n">query_index</span>
<span class="kn">from</span> <span class="nn">proseflow.roam_utils</span> <span class="kn">import</span> <span class="n">roam_graph_to_blocks</span><span class="p">,</span> <span class="n">roam_blocks_to_embeddings_index</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">JSON</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">load_dotenv</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">BUCKET</span> <span class="o">=</span> <span class="s2">&quot;roam-export&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">roam_graph</span> <span class="o">=</span> <span class="n">read_json_from_s3</span><span class="p">(</span><span class="n">bucket</span><span class="o">=</span><span class="n">BUCKET</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;scify.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embedder</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;distilbert-base-nli-mean-tokens&quot;</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="s2">&quot;SENTENCE_TRANSFORMER&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">roam_blocks</span> <span class="o">=</span> <span class="n">roam_graph_to_blocks</span><span class="p">(</span><span class="n">roam_graph</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vectors</span> <span class="o">=</span> <span class="n">text_to_vector</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">roam_blocks</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">embedder</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-11-7c45de583f6a&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>vectors <span class="ansi-blue-fg">=</span> text_to_vector<span class="ansi-blue-fg">(</span>list<span class="ansi-blue-fg">(</span>roam_blocks<span class="ansi-blue-fg">.</span>values<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> embedder<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Desktop/random/proseflow/proseflow/text.py</span> in <span class="ansi-cyan-fg">text_to_vector</span><span class="ansi-blue-fg">(text_form, embedder)</span>
<span class="ansi-green-intense-fg ansi-bold">     15</span> <span class="ansi-red-fg"># TODO: add convert so that i automatically converts a string/np array/dataframe/tensor into a list</span>
<span class="ansi-green-intense-fg ansi-bold">     16</span> <span class="ansi-green-fg">def</span> text_to_vector<span class="ansi-blue-fg">(</span>text_form<span class="ansi-blue-fg">,</span> embedder<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 17</span><span class="ansi-red-fg">     </span>embeddings <span class="ansi-blue-fg">=</span> embedder<span class="ansi-blue-fg">.</span>encode<span class="ansi-blue-fg">(</span>text_form<span class="ansi-blue-fg">,</span> convert_to_tensor<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span>     <span class="ansi-green-fg">return</span> embeddings<span class="ansi-blue-fg">.</span>cpu<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>detach<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>numpy<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     19</span> 

<span class="ansi-red-fg">TypeError</span>: &#39;convert_to_tensor&#39; is an invalid keyword argument for encode()</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">index_list</span> <span class="o">=</span> <span class="n">roam_blocks_to_embeddings_index</span><span class="p">(</span><span class="n">roam_blocks</span><span class="p">,</span> <span class="n">vectors</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-12-0b56847f165d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>index_list <span class="ansi-blue-fg">=</span> roam_blocks_to_embeddings_index<span class="ansi-blue-fg">(</span>roam_blocks<span class="ansi-blue-fg">,</span> vectors<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;vectors&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">retrieved_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embedding&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">retrieved_sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sentence&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">create_index</span><span class="p">(</span><span class="n">retrieved_vectors</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">query_index</span><span class="p">(</span><span class="s2">&quot;Roam sucks&quot;</span><span class="p">,</span> <span class="n">embedder</span><span class="p">,</span> <span class="n">retrieved_sentences</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;They are both based on the faulty idea of [Transmissionism](((ToiqIqjZh))).&#39;,
 &#39;experiments with organoid models are shit. Cellular models are irrepresentative&#39;,
 &#39;Is it listed in a list? (not main resource focus)&#39;,
 &#39;**Books and lectures are bad vehicles for knowledge transfer.** &#39;,
 &#39;In {{alias: ((844_cS3uq)) t-SNE}} global structure may be lost in favor of preserving local distances.&#39;,
 &#34;[Explorable Explanations are Bespoke One-Offs and their Representations Don&#39;t Compose and so the Field is Not Accreting](https://twitter.com/andy_matuschak/status/1305264249032171520)&#34;,
 &#39;Stylistic and things like &#34;summary on top&#34;, **bold if main point**, **nesting** and ^^declarative naming^^&#39;,
 &#39;When x, I want to x, so I can x&#39;,
 &#34;^^Transmissionism^^: the assumption that knowledge is transferred straight from the sender&#39;s output to the receivers input&#34;,
 &#39;avg researcher knows they will never be able to keep up with the literature&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

